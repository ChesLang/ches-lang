# バイトコード仕様書

## 例

```
ORINCHAN

label       1ef211c31e849269    Examples.Hello.main

    call        5362b37v18dee91f
    lspush      $0
    call        b8fb5a506d94846c
    return

label       b8fb5a506d94846c    Examples.Hello.greet

    lspush      "Hello, "
    lspush      $0
    strmrg
    call        0577de596a4147f5
    return

    ifjump      2
    jump
```

## 命令一覧

### nadd

#### 仕様

- スタックのトップとその1つ前の数字を加算します。
- 計算に使用された数字はポップされ、演算結果がプッシュされます。

#### 処理手順

1. スタックのトップとその1つ前の数字をポップする。
2. スタックに演算結果の数値をプッシュする。

### nsub

#### 仕様

- スタックのトップとその1つ前の数字を減算します。
- 計算に使用された数字はポップされ、演算結果がプッシュされます。

#### 処理手順

1. スタックのトップとその1つ前の数字をポップする。
2. スタックに演算結果の数値をプッシュする。

### nmul

#### 仕様

- スタックのトップとその1つ前の数字を乗算します。
- 計算に使用された数字はポップされ、演算結果がプッシュされます。

#### 処理手順

1. スタックのトップとその1つ前の数字をポップする。
2. スタックに演算結果の数値をプッシュする。

### ndiv

#### 仕様

- スタックのトップとその1つ前の数字を除算します。
- 計算に使用された数字はポップされ、演算結果がプッシュされます。

#### 処理手順

1. スタックのトップとその1つ前の数字をポップする。
2. スタックに演算結果の数値をプッシュする。

### land

### lor

### call [関数識別子]

#### 仕様

- 指定されたラベルを呼び出します。

#### 処理手順

1. 指定されたラベルの位置まで移動します。
2. ローカルリストを作成します。
3. ローカルリストに引数をプッシュします。

### callmem [LLインデックス] [関数識別子]

### return [LLインデックス]

戻り値を返して関数の処理を終了します。
関数スタックを１回ポップします。
ローカルスタックに戻り値をプッシュします。

### llset [LLインデックス] [値]

ローカルリストに値を設定します。

### lspush [LSインデックス]

ローカルスタックに値をプッシュします。



< スレッドリスト (TL) >

    スレッドリストは各スレッドの情報を保持します。
    スレッド作成ごとにリストに情報が追加されます。
    このリストの要素はGLをもちます。

< グループリスト (GL) >

    グループリストは各グループの情報を保持します。
    関数呼び出しごとにリストに情報が追加されます。
    このリストの要素はLLとLSをもちます。

< ローカルリスト (LL) >

    ローカルリストはローカル変数などのリスト保持に適したデータを保持します。

< ローカルスタック (LS) >

    ローカルスタックは引数や演算結果などのスタック保持に適したデータを保持します。

< 関数呼び出し >

    1.spush命令でスタックに引数をプッシュ
    2.call命令で関数を呼ぶ

    call命令により引数の長さ分だけスタックがポップされます。
    呼び出し先の関数内でreturn命令を出すことで、呼び出し元の関数のスタックに戻り値がプッシュされます。



goto 関数内の番号で？
